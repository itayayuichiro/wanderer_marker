<!DOCTYPE HTML>
<html>
  <head>
    <title>設定画面</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <link rel="stylesheet" type="text/css" href="../components/loader.css">
    <script src="../components/monaca-jquery/jquery.js"></script>
    <script src="components/loader.js"></script>

    
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
        width:100%;
        background-image:url('./loading1.gif');
        background-repeat:no-repeat;
        background-position: center center;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

    </style>

  </head>
  <body>

    <h1>範囲を設定してください</h1>
    <input type="button" name="" value="中心座標をPOST" placeholder="" onclick="get_position()">
    <p>test</p>
    <div id="map"></div>
    <script>
    var map;
    function get_position(){
      var latlng = map.getCenter();
      var lat = latlng.lat();
      var lng = latlng.lng();
      console.log(lat,lng);
      $.post("http://localhost/gps_manager/index.php",
        { lat: lat, lng: lng },
        function(data){
          //リクエストが成功した際に実行する関数
        }
      );
    }

      function successFunc( position ){
        console.log(position);
        var myLatLng = {lat: position.coords.latitude, lng: position.coords.longitude};
        var markers = [{lat: 35.611, lng: 139.554},{lat: 36.611, lng: 134.554}]
        
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: myLatLng
        });
        for(var i = 0;i < markers.length;i++){
          var marker = new google.maps.Marker({
            position: markers[i],
            map: map,
            title: 'Hello World!'
          });
        }
      }
      function errorFunc( error )
      {
        // エラーコードのメッセージを定義
        var errorMessage = {
          0: "原因不明のエラーが発生しました…。" ,
          1: "位置情報の取得が許可されませんでした…。" ,
          2: "電波状況などで位置情報が取得できませんでした…。" ,
          3: "位置情報の取得に時間がかかり過ぎてタイムアウトしました…。" ,
        } ;

        // エラーコードに合わせたエラー内容をアラート表示
        alert( errorMessage[error.code] ) ;
      }
      var optionObj = {
        "enableHighAccuracy": false ,
        "timeout": 8000 ,
        "maximumAge": 5000 ,
      } ;


      function initMap() {
        var po = navigator.geolocation.getCurrentPosition( successFunc , errorFunc , optionObj ) ;
        console.log(po);

      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYJ8GLMD91pVWUo7gE1tnUcsDmxw5ZMnU&callback=initMap" async defer></script>

  </body>
</html>
